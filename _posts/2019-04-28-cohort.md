---
title: Cohort Analysis
author: Yu Donghwi
date: 2019-04-28
category: Jekyll
layout: post
---

### 1. Definition ###

 Actor를 시작 날짜를 기준으로 segment하여 cohort group으로 분류한 후 각 집단 별 retention에 기초해 이탈율, LTV(Life time value), returnship 등의 지표를 도출하는 데이터 분석 기법을 의미한다. 별도의 통계학, CS, AI에 대한 지식 없이 기초적인 RDBMS 쿼리를 통해 분석의 AtoZ를 수행할 수 있으며 강력한 비지니스 인사이트를 제공해줄 수 있어 Funnel 분석, A/B test와 함께 여러 분야에서 가장 많이 쓰이는 데이터 분석 기법이다.

>##### cohort
>
> 라틴어로 울타리를 뜻하는 cohortem에서 유래한 용어로서 '동질 집단'을 뜻한다. 특정 기간 동안 동일한 역사적 사건을 경험한 세대를 cohort로 정의하고 각 cohort의 행동 특성을 비교분석한 사회학 연구에서 시작하여 다양한 영역에서 cohort의 개념을 다루기 시작하였다. 빅데이터 분야에서 cohort란 주로 입학 날짜가 동일한 학생들, 같은 달에 가입한 온라인 쇼핑몰 회원 등 시작 날짜가 동일한 집단을 의미한다. 
{: .block-tip }



#### dataset

![](https://github.com/user-attachments/assets/c06bf7cc-8e20-4468-a692-326e7d3f2981)


cf) 분석에 사용된 dataset은 미국 국회의원의 인적사항 및 임기, 소속에 대한 자료이며 [이곳][1] 에서 접근 가능합니다.


### 2. Retention ###

retention의 사전적 의미는 '유지'이다. Cohort analysis에서 retention은 특정 시점에서 각 cohort 별로 이탈하지 않고 남아있는 고객의 비율을 의미한다. 주어진 dataset에서 retention이란 국회의원의 임기 유지 기간을 의미하며 아래에서 MySQL을 통해 이를 도출할 것이다.

#### 2-1. Deriving retention ####

```yaml

SELECT period
,cohort_retained
,cohort_retained/first_value(cohort_retained) over (order by period) AS pct_retained 
FROM
(
SELECT timestampdiff(year, a.first_term, b.term_start) AS period
, count(distinct a.id_bioguide) AS cohort_retained
FROM
(
SELECT id_bioguide
, min(term_start) as first_term 
FROM legislators_terms 
GROUP BY 1
) a
JOIN legislators_terms b ON a.id_bioguide = b.id_bioguide
GROUP BY 1
) c
;

```

![](https://github.com/user-attachments/assets/3c296858-8331-4338-9fa1-b20c80789d54)
![](https://github.com/user-attachments/assets/e8813fe9-de82-4a1f-83d8-704cc61d8269)

<br>
<br>

Query의 첫 번째 Inline view를 통해 각 국회의원의 첫 임기 시작일(first_term)을 도출하였다.
<br>
<br>
그리고 두 번째 Inline view를 통해서 국회의원들의 임기 연도에서 첫 임기 연도를 빼서 의원직 유지 년수(period)를 도출하였다.
<br>
<br>
마지막으로 최종적인 DML에서 각 period별 인원수를 첫 구간의 인원수로 나누어서 구간별 의원직 유지 비율(retention)을 도출하였다.
<br>
<br>
<br>
대부분의 cohort analysis에서 retention은 위와 같이 초반에 급격히 낮아진 후 점차 완만히 감소하는 형태를 보인다. 예를 들어 게임을 런칭 했을 때 많은 게이머들이 호기심에 게임을 설치해 플레이해보지만 오래지 않아 취향이 맞지 않는 대다수의 유저들이 이탈하게 되며 충성심 높은 일부 유저들만 남는 것은 지극히 상식적인 일이다. 주어진 dataset의 경우에도 국회의원의 다선 비율이 높지 않기 때문에 위와 같은 결과가 나타난 것은 지극히 당연한 결과일 것다. 따라서 위와 같이 일반적인 형태의 retention curve가 도출 됐을 경우에는 장기적인 추세선에 의미를 두기보다 event들이 retention의 단기적인 변동에 어떠한 영향을 주었는지 분석하는 과정이 필요할 것이다.


#### 2-2. Parameter tuning ####

### 3. Segmentation ### 

#### 3-1. Single relation ####

#### 3-2. Sub-query ####

#### 3-3. Rare cohort ####

#### 3-4. hyper-parameter tuning ####

### 4. Survival Analysis ###

### 5. Returnship Analysis ###

### 6. LTV Analysis ###



[1]: https://github.com/YuDH-DS/YuDH-DS.github.io/tree/main/_posts/cohort%EB%B6%84%EC%84%9D%20raw%20data